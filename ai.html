<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Local WebNN Chatbot</title>
    <style>
        body { font-family: sans-serif; background: #111; color: #eee; display: flex; flex-direction: column; align-items: center; }
        #chat { width: 90%; max-width: 600px; height: 400px; border: 1px solid #444; overflow-y: auto; padding: 15px; margin-top: 20px; }
        #status { font-size: 0.8em; color: #888; margin: 10px; }
        input { width: 80%; padding: 10px; background: #222; border: 1px solid #444; color: white; }
    </style>
</head>
<body>
    <h2>Local AI (SmolLM-135M)</h2>
    <div id="status">Loading model (approx. 15MB)...</div>
    <div id="chat"></div>
    <div style="width: 90%; max-width: 600px; display: flex;">
        <input type="text" id="input" placeholder="Ask me something..." disabled>
        <button id="send" disabled>Send</button>
    </div>

    <script type="module">
        import { pipeline } from 'https://cdn.jsdelivr.net/npm/@xenova/transformers@2.17.2';

        const status = document.getElementById('status');
        const chat = document.getElementById('chat');
        const input = document.getElementById('input');
        const btn = document.getElementById('send');

        // Initialize text-generation pipeline
        // Note: Transformers.js v3+ uses WebNN/WebGPU automatically if available
        const generator = await pipeline('text-generation', 'Xenova/SmolLM-135M-Instruct');
        
        status.textContent = "Model Loaded. Running 100% locally.";
        input.disabled = false;
        btn.disabled = false;

        async function generateResponse() {
            const text = input.value;
            chat.innerHTML += `<div><b>You:</b> ${text}</div>`;
            input.value = '';

            const output = await generator(text, { 
                max_new_tokens: 50, 
                temperature: 0.7,
                repetition_penalty: 1.2
            });

            const reply = output[0].generated_text.replace(text, '').trim();
            chat.innerHTML += `<div><b>AI:</b> ${reply}</div>`;
            chat.scrollTop = chat.scrollHeight;
        }

        btn.onclick = generateResponse;
        input.onkeypress = (e) => { if(e.key === 'Enter') generateResponse(); };
    </script>
</body>
  </html>
  
